{"ast":null,"code":"var _jsxFileName = \"/Users/jungsooyoung/Documents/software modelling/Amenity-Scope/amenity-scope/src/utils/searchNearbyAmenities.js\";\n/* global google */\nimport ReactDOMServer from 'react-dom/server';\nimport CustomerMarker from '../components/Map/\bCustomMarker';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction normalizeName(name) {\n  return name.toLowerCase().replace(/building\\s*\\d+/g, '').replace(/academic|campus|centre|center|college|institute|school|university/g, '').replace(/[^a-z0-9]/g, '').trim();\n}\nfunction removeDuplicatePlacesByName(places) {\n  const seen = new Set();\n  return places.filter(place => {\n    const norm = normalizeName(place.displayName);\n    if ([...seen].some(existing => norm.includes(existing) || existing.includes(norm))) {\n      return false;\n    }\n    seen.add(norm);\n    return true;\n  });\n}\nexport async function searchNearbyAmenities({\n  map,\n  clickedLocation,\n  radius,\n  includedPrimaryTypes,\n  isMajorMode = false\n}) {\n  const {\n    Place,\n    SearchNearbyRankPreference\n  } = await google.maps.importLibrary('places');\n  const {\n    AdvancedMarkerElement\n  } = await google.maps.importLibrary('marker');\n\n  // Define allowed primary types per category\n  const CATEGORY_TYPE_MAP = {\n    education: ['primary_school', 'secondary_school', 'university'],\n    medical: ['hospital'],\n    grocery: ['supermarket', 'grocery_store', 'department_store', 'shopping_mall', 'asian_grocery'],\n    transport: ['train_station', 'subway_station', 'bus_station', 'transit_station', 'light_rail_station'],\n    green: ['park', 'state_park', 'campground', 'rv_park'],\n    culture: ['museum', 'library', 'art_gallery', 'stadium', 'concert_hall']\n  };\n\n  // Create a reverse lookup table for assigning categories later\n  const categoryReverseLookup = {};\n  for (const [category, types] of Object.entries(CATEGORY_TYPE_MAP)) {\n    for (const type of types) {\n      categoryReverseLookup[type] = category;\n    }\n  }\n  if (!isMajorMode) {\n    const request = {\n      locationRestriction: {\n        center: clickedLocation,\n        radius\n      },\n      fields: ['displayName', 'location', 'businessStatus', 'types', 'rating', 'userRatingCount'],\n      includedPrimaryTypes,\n      maxResultCount: 20,\n      rankPreference: SearchNearbyRankPreference.POPULARITY,\n      language: 'en-AU'\n    };\n    const {\n      places = []\n    } = await Place.searchNearby(request);\n    const filteredPlaces = places.filter(place => {\n      var _place$userRatingCoun, _place$rating, _place$types, _place$displayName$to, _place$displayName;\n      if (place.businessStatus !== 'OPERATIONAL') return false; // Only operational businesses\n      if (((_place$userRatingCoun = place.userRatingCount) !== null && _place$userRatingCoun !== void 0 ? _place$userRatingCoun : 0) < 2) return false; // At least 2 reviews\n      if (((_place$rating = place.rating) !== null && _place$rating !== void 0 ? _place$rating : 0) < 3) return false; // Minimum 3 rating\n\n      const types = (_place$types = place.types) !== null && _place$types !== void 0 ? _place$types : [];\n      const name = (_place$displayName$to = (_place$displayName = place.displayName) === null || _place$displayName === void 0 ? void 0 : _place$displayName.toLowerCase()) !== null && _place$displayName$to !== void 0 ? _place$displayName$to : '';\n\n      // Include if it's a registered educational institution\n      if (types.some(t => CATEGORY_TYPE_MAP.education.includes(t))) {\n        return true;\n      }\n\n      // Include only facilities explicitly marked as hospitals\n      if (types.includes('hospital') && name.includes('hospital') || types.includes('clinic') && /specialist|surgery|medical|health/.test(name)) {\n        return true;\n      }\n\n      // Include if it's an asian_grocery type\n      if (types.includes('asian_grocery')) {\n        return true;\n      }\n      // Include major grocery brands if type matches and name matches\n      if (types.some(t => ['supermarket', 'grocery_store', 'department_store', 'shopping_mall', 'asian_grocery'].includes(t)) && /coles|woolworths|aldi|outlet/.test(name)) {\n        return true;\n      }\n\n      // All transport types included\n      if (types.some(t => CATEGORY_TYPE_MAP.transport.includes(t))) {\n        return true;\n      }\n\n      // Public parks with decent reviews\n      if (types.some(t => CATEGORY_TYPE_MAP.green.includes(t)) && place.userRatingCount >= 10 && place.rating >= 3.8) {\n        return true;\n      }\n\n      // Cultural places with decent reviews\n      if (types.some(t => CATEGORY_TYPE_MAP.culture.includes(t)) && place.userRatingCount >= 10 && place.rating >= 3.8) {\n        return true;\n      }\n      return false; // Filter out everything else (including 'other')\n    });\n\n    // Remove name-duplicate entries\n    const uniquePlaces = removeDuplicatePlacesByName(filteredPlaces);\n\n    // Assign categories to places\n    uniquePlaces.forEach(place => {\n      var _place$types2;\n      const matchedCategory = (_place$types2 = place.types) === null || _place$types2 === void 0 ? void 0 : _place$types2.map(t => categoryReverseLookup[t]).find(Boolean);\n      place.category = matchedCategory || null;\n    });\n    const finalPlaces = removeDuplicatePlacesByName(uniquePlaces);\n\n    // Render markers for each place\n    const markers = finalPlaces.map((place, index) => {\n      const markerHTML = ReactDOMServer.renderToStaticMarkup(/*#__PURE__*/_jsxDEV(CustomerMarker, {\n        number: index + 1\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 9\n      }, this));\n      const wrapper = document.createElement('div');\n      wrapper.innerHTML = markerHTML;\n      return new AdvancedMarkerElement({\n        map,\n        position: place.location,\n        title: place.displayName,\n        content: wrapper.firstChild\n      });\n    });\n    return {\n      places: finalPlaces,\n      markers\n    };\n  }\n}","map":{"version":3,"names":["ReactDOMServer","CustomerMarker","jsxDEV","_jsxDEV","normalizeName","name","toLowerCase","replace","trim","removeDuplicatePlacesByName","places","seen","Set","filter","place","norm","displayName","some","existing","includes","add","searchNearbyAmenities","map","clickedLocation","radius","includedPrimaryTypes","isMajorMode","Place","SearchNearbyRankPreference","google","maps","importLibrary","AdvancedMarkerElement","CATEGORY_TYPE_MAP","education","medical","grocery","transport","green","culture","categoryReverseLookup","category","types","Object","entries","type","request","locationRestriction","center","fields","maxResultCount","rankPreference","POPULARITY","language","searchNearby","filteredPlaces","_place$userRatingCoun","_place$rating","_place$types","_place$displayName$to","_place$displayName","businessStatus","userRatingCount","rating","t","test","uniquePlaces","forEach","_place$types2","matchedCategory","find","Boolean","finalPlaces","markers","index","markerHTML","renderToStaticMarkup","number","fileName","_jsxFileName","lineNumber","columnNumber","wrapper","document","createElement","innerHTML","position","location","title","content","firstChild"],"sources":["/Users/jungsooyoung/Documents/software modelling/Amenity-Scope/amenity-scope/src/utils/searchNearbyAmenities.js"],"sourcesContent":["/* global google */\nimport ReactDOMServer from 'react-dom/server';\nimport CustomerMarker from '../components/Map/\bCustomMarker';\n\nfunction normalizeName(name) {\n  return name.toLowerCase()\n    .replace(/building\\s*\\d+/g, '')\n    .replace(/academic|campus|centre|center|college|institute|school|university/g, '')\n    .replace(/[^a-z0-9]/g, '')\n    .trim();\n}\n\nfunction removeDuplicatePlacesByName(places) {\n  const seen = new Set();\n  return places.filter(place => {\n    const norm = normalizeName(place.displayName);\n    if ([...seen].some(existing => norm.includes(existing) || existing.includes(norm))) {\n      return false;\n    }\n    seen.add(norm);\n    return true;\n  });\n}\n\nexport async function searchNearbyAmenities({ map, clickedLocation, radius, includedPrimaryTypes, isMajorMode = false }) {\n  const { Place, SearchNearbyRankPreference } = await google.maps.importLibrary('places');\n  const { AdvancedMarkerElement } = await google.maps.importLibrary('marker');\n\n  // Define allowed primary types per category\n  const CATEGORY_TYPE_MAP = {\n    education: ['primary_school', 'secondary_school', 'university'],\n    medical: ['hospital'],\n    grocery: ['supermarket', 'grocery_store', 'department_store', 'shopping_mall', 'asian_grocery'],\n    transport: ['train_station', 'subway_station', 'bus_station', 'transit_station', 'light_rail_station'],\n    green: ['park', 'state_park', 'campground', 'rv_park'],\n    culture: ['museum', 'library', 'art_gallery', 'stadium', 'concert_hall'],\n  };\n\n  // Create a reverse lookup table for assigning categories later\n  const categoryReverseLookup = {};\n  for (const [category, types] of Object.entries(CATEGORY_TYPE_MAP)) {\n    for (const type of types) {\n      categoryReverseLookup[type] = category;\n    }\n  }\n\n  if (!isMajorMode) {\n    const request = {\n      locationRestriction: {\n        center: clickedLocation,\n        radius,\n      },\n      fields: ['displayName', 'location', 'businessStatus', 'types', 'rating', 'userRatingCount'],\n      includedPrimaryTypes,\n      maxResultCount: 20,\n      rankPreference: SearchNearbyRankPreference.POPULARITY,\n      language: 'en-AU',\n    };\n\n    const { places = [] } = await Place.searchNearby(request);\n\n    const filteredPlaces = places.filter(place => {\n      if (place.businessStatus !== 'OPERATIONAL') return false; // Only operational businesses\n      if ((place.userRatingCount ?? 0) < 2) return false;        // At least 2 reviews\n      if ((place.rating ?? 0) < 3) return false;               // Minimum 3 rating\n\n      const types = place.types ?? [];\n      const name = place.displayName?.toLowerCase() ?? '';\n\n      // Include if it's a registered educational institution\n      if (types.some(t => CATEGORY_TYPE_MAP.education.includes(t))) {\n        return true;\n      }\n\n      // Include only facilities explicitly marked as hospitals\n      if ((types.includes('hospital') && name.includes('hospital')) ||\n          (types.includes('clinic') && /specialist|surgery|medical|health/.test(name))) {\n        return true;\n      }\n\n      // Include if it's an asian_grocery type\n      if (types.includes('asian_grocery')) {\n        return true;\n      }\n      // Include major grocery brands if type matches and name matches\n      if (types.some(t => ['supermarket', 'grocery_store', 'department_store', 'shopping_mall', 'asian_grocery'].includes(t)) &&\n          /coles|woolworths|aldi|outlet/.test(name)) {\n        return true;\n      }\n\n      // All transport types included\n      if (types.some(t => CATEGORY_TYPE_MAP.transport.includes(t))) {\n        return true;\n      }\n\n      // Public parks with decent reviews\n      if (types.some(t => CATEGORY_TYPE_MAP.green.includes(t)) && place.userRatingCount >= 10 && place.rating >= 3.8) {\n        return true;\n      }\n\n      // Cultural places with decent reviews\n      if (types.some(t => CATEGORY_TYPE_MAP.culture.includes(t)) && place.userRatingCount >= 10 && place.rating >= 3.8) {\n        return true;\n      }\n\n      return false; // Filter out everything else (including 'other')\n    });\n\n    // Remove name-duplicate entries\n    const uniquePlaces = removeDuplicatePlacesByName(filteredPlaces);\n\n    // Assign categories to places\n    uniquePlaces.forEach(place => {\n      const matchedCategory = place.types?.map(t => categoryReverseLookup[t]).find(Boolean);\n      place.category = matchedCategory || null;\n    });\n\n    const finalPlaces = removeDuplicatePlacesByName(uniquePlaces);\n\n    // Render markers for each place\n    const markers = finalPlaces.map((place, index) => {\n      const markerHTML = ReactDOMServer.renderToStaticMarkup(\n        <CustomerMarker number={index + 1} />\n      );\n      const wrapper = document.createElement('div');\n      wrapper.innerHTML = markerHTML;\n      return new AdvancedMarkerElement({\n        map,\n        position: place.location,\n        title: place.displayName,\n        content: wrapper.firstChild,\n      });\n    });\n\n    return { places: finalPlaces, markers };\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}